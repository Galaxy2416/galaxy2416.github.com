<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>avr系列:(一)在linux下搭建avr开发平台 | Galaxy2416&#39;s blog</title>
  <meta name="author" content="galaxy2416">
  
    <!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>

  
  
  <meta name="description" content="galaxy2416 blog">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="avr系列:(一)在linux下搭建avr开发平台"/>
  <meta property="og:site_name" content="Galaxy2416&#39;s blog"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Galaxy2416&#39;s blog" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  
</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1>
  <a href="https://github.com/galaxy2416" target="_blank">
	<img style="position: absolute; top: 0; left: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_left_white_ffffff.png" alt="Fork me on GitHub">
	</a><a href="/">Galaxy2416&#39;s blog</a>
  	  <a href="/"><img src="/img/pikadrink.jpg" style = "top:0;width:100px;height:65px"></h1>
  <h2><a href="/">o(∩∩)o活在一次元～语不惊人死不休</a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
      <li><a href="/about">About</a></li>
    
	<li> <a href="/atom.xml">RSS</a> </li>
	<li> <a title="把这个链接拖到你的Chrome收藏夹工具栏中" href='javascript:(function() {
	function c() {
		var e = document.createElement("link");
		e.setAttribute("type", "text/css");
		e.setAttribute("rel", "stylesheet");
		e.setAttribute("href", f);
		e.setAttribute("class", l);
		document.body.appendChild(e)
	}
 
	function h() {
		var e = document.getElementsByClassName(l);
		for (var t = 0; t < e.length; t++) {
			document.body.removeChild(e[t])
		}
	}
 
	function p() {
		var e = document.createElement("div");
		e.setAttribute("class", a);
		document.body.appendChild(e);
		setTimeout(function() {
			document.body.removeChild(e)
		}, 100)
	}
 
	function d(e) {
		return {
			height : e.offsetHeight,
			width : e.offsetWidth
		}
	}
 
	function v(i) {
		var s = d(i);
		return s.height > e && s.height < n && s.width > t && s.width < r
	}
 
	function m(e) {
		var t = e;
		var n = 0;
		while (!!t) {
			n += t.offsetTop;
			t = t.offsetParent
		}
		return n
	}
 
	function g() {
		var e = document.documentElement;
		if (!!window.innerWidth) {
			return window.innerHeight
		} else if (e && !isNaN(e.clientHeight)) {
			return e.clientHeight
		}
		return 0
	}
 
	function y() {
		if (window.pageYOffset) {
			return window.pageYOffset
		}
		return Math.max(document.documentElement.scrollTop, document.body.scrollTop)
	}
 
	function E(e) {
		var t = m(e);
		return t >= w && t <= b + w
	}
 
	function S() {
		var e = document.createElement("audio");
		e.setAttribute("class", l);
		e.src = i;
		e.loop = false;
		e.addEventListener("canplay", function() {
			setTimeout(function() {
				x(k)
			}, 500);
			setTimeout(function() {
				N();
				p();
				for (var e = 0; e < O.length; e++) {
					T(O[e])
				}
			}, 15500)
		}, true);
		e.addEventListener("ended", function() {
			N();
			h()
		}, true);
		e.innerHTML = " <p>If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.</p> <p>";
		document.body.appendChild(e);
		e.play()
	}
 
	function x(e) {
		e.className += " " + s + " " + o
	}
 
	function T(e) {
		e.className += " " + s + " " + u[Math.floor(Math.random() * u.length)]
	}
 
	function N() {
		var e = document.getElementsByClassName(s);
		var t = new RegExp("\\b" + s + "\\b");
		for (var n = 0; n < e.length; ) {
			e[n].className = e[n].className.replace(t, "")
		}
	}
 
	var e = 30;
	var t = 30;
	var n = 350;
	var r = 350;
	var i = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake.mp3";
	var s = "mw-harlem_shake_me";
	var o = "im_first";
	var u = ["im_drunk", "im_baked", "im_trippin", "im_blown"];
	var a = "mw-strobe_light";
	var f = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake-style.css";
	var l = "mw_added_css";
	var b = g();
	var w = y();
	var C = document.getElementsByTagName("*");
	var k = null;
	for (var L = 0; L < C.length; L++) {
		var A = C[L];
		if (v(A)) {
			if (E(A)) {
				k = A;
				break
			}
		}
	}
	if (A === null) {
		console.warn("Could not find a node of the right size. Please try a different page.");
		return
	}
	c();
	S();
	var O = [];
	for (var L = 0; L < C.length; L++) {
		var A = C[L];
		if (v(A)) {
			O.push(A)
		}
	}
})()    '>摇啊摇</a> </li>
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2014-02-06T12:59:49.000Z"><a href="/2014/02/06/linux-avr-1/">2月 6 2014</a></time>
      
      
  
    <h1 class="title">avr系列:(一)在linux下搭建avr开发平台</h1>
  

    </header>
    <div class="entry">
      
        <h3 id="-ubuntu-atmeg16-avr-gcc-usbasp-">此篇以Ubuntu下的atmeg16，avr-gcc + usbasp的开发环境搭建来进行说明。</h3>
<p><strong>由于文章迁移手头没有avr一部分图片用的以前的，看颜色也能看出来，会在后期改掉的，但效果是ok的</strong></p>
<p>系列说明：avr作为很成功的一系列芯片，在开源上受到了极大的关注，因为使其在linux环境下的开发充满乐趣和色彩。</p>
<p>环境如下：</p>
<ul>
<li>OS系统：ubuntu 12.04（原为10.04最近升级了）</li>
<li>编译器 ：avr-gcc</li>
<li>烧录软件 :avrdude</li>
<li>调试软件:avarice ，GDB和ddd （可视界面）</li>
<li>开发板：</li>
</ul>
<ol>
<li><p>xplain(xmega128a1)无法调试，只能烧录，因为官方没有公开其调试的协议。</p>
</li>
<li><p>Mega16开发板。</p>
</li>
</ol>
<p>仿真器or烧录器：dragon和usbasp（使用较多）</p>
<h2 id="-more-"><a id="more"></a></h2>
<center><strong>关于使用前的准备和说明</strong></center>

<p>  至于为什么要使用linux下开发avr，原因主要是因为比较有趣。其次便是win下的环境用起来其实并不是很方便。IAR是付费软件（但是的确好用），Avr-studio虽然是免费版，不过优缺点是太过庞大，并且是以vc为基础开发，这个也就算不上真正的免费了。至于win-avr其实蛮不错的。win下也可以搭建如下环境,对于avr有一个比较帅气的项目可以快速开发使用avr-<a href="http://www.arduino.cc/" target="_blank">Arduino</a>，不得不说这个项目简直漂亮极了，硬件和软件以及很多简单到极致的封装代码，感兴趣应该看看，在以后可能会介绍下。</p>
<p><code>软件准备工作:</code></p>
<p>软件安装建议使用ubuntu的软件中心，比较方便。需要avr-gcc，avrdude,avarice,gdb,ddd即可了。文本编辑什么都行。可以集成在codeblocks和eclipse里面。codeblocks如此做用起来感觉不错，原理都是一样的。</p>
<p>对于命令行可以如下安装。对于一些附带库和文档自行选择即可～</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
</pre></td><td class="code"><pre>sudo apt<span class="attribute">-get</span> install gcc<span class="attribute">-avrbinuilts</span><span class="attribute">-avr</span> avr<span class="attribute">-libc</span>
sudo apt<span class="attribute">-get</span> install avrdude
sudo apt<span class="attribute">-get</span> install avarice
sudo apt<span class="attribute">-get</span> install gdb
sudo apt<span class="attribute">-get</span> install ddd
</pre></td></tr></table></figure>

<p>建议安装文档</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>sudo apt<span class="attribute">-get</span> install avrdude<span class="attribute">-doc</span>
</pre></td></tr></table></figure>

<p><code>测试开始</code></p>
<p>开始之前需要先写一个main.c的程序</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
</pre></td><td class="code"><pre><span class="comment">// avr-gcc application builder : 2011-11-1 </span>
<span class="comment">// Target : M16</span>
<span class="comment">// Crystal: 12.000Mhz</span>

<span class="preprocessor">#include &lt;avr/io.h&gt;</span>
<span class="preprocessor">#include &lt;util/delay.h&gt;</span>
<span class="preprocessor">#define SET(a,b) a|(1&lt;&lt;b)</span>
<span class="preprocessor">#define CLR(a,b) a &~(1&lt;&lt;b)</span>
<span class="keyword">void</span> port_init(<span class="keyword">void</span>)
{
<span class="constant"> DDRA </span> = <span class="number">0xff</span>;<span class="comment">//将PA0定义为输出</span>
<span class="constant"> PORTA </span>= <span class="number">0xff</span>;
<span class="constant"> PORTB </span>= <span class="number">0x00</span>;
<span class="constant"> DDRB </span> = <span class="number">0x00</span>;
<span class="constant"> PORTC </span>= <span class="number">0x00</span>; <span class="comment">//m103 output only</span>
<span class="constant"> DDRC </span> = <span class="number">0x00</span>;
<span class="constant"> PORTD </span>= <span class="number">0x00</span>;
<span class="constant"> DDRD </span> = <span class="number">0x00</span>;
}

<span class="comment">//call this routine to initialize all peripherals</span>
<span class="keyword">void</span> init_devices(<span class="keyword">void</span>)
{
 <span class="comment">//stop errant interrupts until set up</span>
 <span class="comment">//CLI(); //disable all interrupts</span>
 port_init();
<span class="constant"> MCUCR </span>= <span class="number">0x00</span>;
<span class="constant"> GICR </span> = <span class="number">0x00</span>;
<span class="constant"> TIMSK </span>= <span class="number">0x00</span>; <span class="comment">//timer interrupt sources</span>
<span class="comment">// SEI(); //re-enable interrupts</span>
 <span class="comment">//all peripherals are now initialized</span>
}

<span class="comment">//</span>
<span class="keyword">void</span> main(<span class="keyword">void</span>)
{
 init_devices();
 <span class="comment">//insert your functional code here...</span>
<span class="constant"> PORTA </span>= CLR(PORTA,<span class="number">3</span>);
 <span class="keyword">while</span>(<span class="number">1</span>);  <span class="comment">//程序挂起		</span>
}
</pre></td></tr></table></figure>

<p>这是一个很简单让一个小灯点亮的程序。</p>
<p>由于avr使用的是makefile模板，介绍下makefile，此物是简化操作流程的一个东西。让敲好多行命令才能完成的只需简单的一句话就行了。后文会附一个makefile的模板，是winavr下模板改的可用版。具体的内容是如何实现的，可以翻阅官方makefile手册和百度，谷歌。</p>
<p>简单介绍Makefile里面的几个命令，有过经验可以忽略这里</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
</pre></td><td class="code"><pre><span class="comment">#dragon_jtag</span>
<span class="constant">AVRDUDE_PORT</span> = usb   # programmer connected to serial device
<span class="constant">AVRDUDE_WRITE_FLASH</span> = -Uflash:w:<span class="variable">$(TARGET)</span>.hex
<span class="constant">AVRDUDE_FLAGS</span> = -p <span class="variable">$(MCU)</span> -P<span class="variable">$(AVRDUDE_PORT)</span> -c <span class="variable">$(AVRDUDE_PROGRAMMER)</span>
<span class="constant">AVRDUDE_FLAGS</span> += <span class="variable">$(AVRDUDE_NO_VERIFY)</span>
<span class="constant">AVRDUDE_FLAGS</span> += <span class="variable">$(AVRDUDE_VERBOSE)</span>
<span class="constant">AVRDUDE_FLAGS</span> += <span class="variable">$(AVRDUDE_ERASE_COUNTER)</span>
</pre></td></tr></table></figure>

<p>上面这些都是定义变量，makefile里的</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
</pre></td><td class="code"><pre><span class="symbol">program:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).hex <span class="variable">$(</span><span class="constant">TARGET</span>).eep
     <span class="variable">$(</span><span class="constant">AVRDUDE</span>)<span class="variable">$(</span><span class="constant">AVRDUDE_FLAGS</span>) <span class="variable">$(</span><span class="constant">AVRDUDE_WRITE_FLASH</span>) <span class="variable">$(</span><span class="constant">AVRDUDE_WRITE_EEPROM</span>)
</pre></td></tr></table></figure>

<p>当我们输入make program时就会执行上面这句之前的都不用关心了。翻译过来就变成了(如果叫main.hex)</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre>avrdude <span class="attribute">-P</span> usb <span class="attribute">-p</span> m16 <span class="attribute">-c</span> usbasp <span class="attribute">-U</span> flash:w:main<span class="built_in">.</span>hex
</pre></td></tr></table></figure>

<p>就是说用usb下的usbasp烧录m16的flash，内容为main.hex</p>
<p>如果用dragon的话一般用jtag就是-c dragon_jtag。具体可以查看avrdude手册。</p>
<p>了解之后先打开终端，找到.c文件目录下。Makefile文件放在同一目录下</p>
<p>根据需要更改其内容</p>
<p><code>编译</code></p>
<p>输入make</p>
<p>便会输出一些信息</p>
<p><img src="/img/linux-avr-1/make.png" alt="make"></p>
<p>编译成功之后就可以烧录了</p>
<p>烧录之前看一下烧录器是否在</p>
<p>输入lsusb</p>
<p><img src="/img/linux-avr-1/lsusb.png" alt="lsusb"></p>
<p>可以看到烧录器件存在。</p>
<p><code>烧录</code></p>
<p>输入<code>sudo make program</code></p>
<p><img src="/img/linux-avr-1/makepro.jpg" alt="makepro"></p>
<p>会在很快的时间内烧录成功。最后提示你烧录成功</p>
<p><img src="/img/linux-avr-1/prook.jpg" alt="prook"></p>
<p><code>调试</code></p>
<p>至于debug，usbasp没有这个功能。需要用dragon的jtag。</p>
<p>注：Debug其实不是很推荐使用，虽然比较高效，建议利用串口的信息输入输出（以后会介绍），这是因为在进入系统的嵌入后，常规的debug经常会无法使用。</p>
<p>实际使用要用avarice</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
</pre></td><td class="code"><pre><span class="comment">avarice</span> <span class="literal">-</span><span class="comment">g</span> <span class="literal">-</span><span class="comment">j</span> <span class="comment">usb</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">erase</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">program</span> <span class="literal">-</span><span class="literal">-</span><span class="comment">filemain</span><span class="string">.</span><span class="comment">hex</span> <span class="comment">:4242</span>
</pre></td></tr></table></figure>

<p>不过如果makefile里已经写好的话直接输入`sudo make debug``就可以了</p>
<p>下面为命令的结果</p>
<p><img src="/img/linux-avr-1/avarice.jpg" alt="avarice"></p>
<p><em>由于我的dragon被物主回收了，所以只能用老图了</em></p>
<p>现在属于等待GDB，可视化的话就是DDD的状态中了</p>
<p>比如在gdb.conf中添加</p>
<p>file main.elf</p>
<p>target remotelocalhost:4242</p>
<p>启动DDD</p>
<p><code>ddd–-debugger “avr-gdb -x gdb.conf”</code></p>
<p><img src="/img/linux-avr-1/ddd.jpg" alt="ddd"></p>
<p>也可以手起动，然后配置，ui界面比较友好。</p>
<p>还有一句话。makefile里面已经把上步骤都做好了～当然会根据需求要求更改的。尤其是debug的时候。</p>
<p>总结：本文所说有些简略了，linux开发的困难主要在于搭建环境，因此需要多看一下相关的官方手册。</p>
<hr>
<p><strong>附录：</strong></p>
<p>模板Makefile(内容请自行修改)</p>
<p>make : 编译</p>
<p>make program : 烧录</p>
<p>make debug : 调试</p>
<figure class="highlight"><table><tr><td class="gutter"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
</pre></td><td class="code"><pre><span class="comment"># Hey Vim, this is a -*- makefile -*-  </span>
<span class="comment">#----------------------------------------------------------------------------  </span>
<span class="comment"># WinAVR Makefile Template written by Eric B. Weddington, Jörg Wunsch, et al.  </span>
<span class="comment"># Linux GCC using is changed by Galaxy2416  </span>
<span class="comment"># Released to the Public Domain  </span>
<span class="comment">#  </span>
<span class="comment"># Additional material for this makefile was written by:  </span>
<span class="comment"># Peter Fleury  </span>
<span class="comment"># Tim Henigan  </span>
<span class="comment"># Colin O'Flynn  </span>
<span class="comment"># Reiner Patommel  </span>
<span class="comment"># Markus Pfaff  </span>
<span class="comment"># Sander Pool  </span>
<span class="comment"># Frederik Rouleau  </span>
<span class="comment"># Carlos Lamas  </span>
<span class="comment">#  </span>
<span class="comment">#----------------------------------------------------------------------------  </span>
<span class="comment"># On command line:  </span>
<span class="comment">#  </span>
<span class="comment"># make all = Make software.  </span>
<span class="comment">#  </span>
<span class="comment"># make clean = Clean out built project files.  </span>
<span class="comment">#  </span>
<span class="comment"># make coff = Convert ELF to AVR COFF.  </span>
<span class="comment">#  </span>
<span class="comment"># make extcoff = Convert ELF to AVR Extended COFF.  </span>
<span class="comment">#  </span>
<span class="comment"># make program = Download the hex file to the device, using avrdude.  </span>
<span class="comment">#                Please customize the avrdude settings below first!  </span>
<span class="comment">#  </span>
<span class="comment"># make debug = Start either simulavr or avarice as specified for debugging,   </span>
<span class="comment">#              with avr-gdb or avr-insight as the front end for debugging.  </span>
<span class="comment">#  </span>
<span class="comment"># make filename.s = Just compile filename.c into the assembler code only.  </span>
<span class="comment">#  </span>
<span class="comment"># make filename.i = Create a preprocessed source file for use in submitting  </span>
<span class="comment">#                   bug reports to the GCC project.  </span>
<span class="comment">#  </span>
<span class="comment"># To rebuild project do "make clean" then "make all".  </span>
<span class="comment">#----------------------------------------------------------------------------  </span>
  
  
<span class="comment"># MCU name  </span>
<span class="constant">MCU</span> = atmega16  
<span class="comment">#atxmega128a1  </span>
  
  
<span class="comment"># Processor frequency.  </span>
<span class="comment">#     This will define a symbol, F_CPU, in all source code files equal to the   </span>
<span class="comment">#     processor frequency. You can then use this symbol in your source code to   </span>
<span class="comment">#     calculate timings. Do NOT tack on a 'UL' at the end, this will be done  </span>
<span class="comment">#     automatically to create a 32-bit value in your source code.  </span>
<span class="comment">#     Typical values are:  </span>
<span class="comment">#         F_CPU =  1000000  </span>
<span class="comment">#         F_CPU =  1843200  </span>
<span class="comment">#         F_CPU =  2000000  </span>
<span class="comment">#         F_CPU =  3686400  </span>
<span class="comment">#         F_CPU =  4000000  </span>
<span class="comment">#         F_CPU =  7372800  </span>
<span class="comment">#         F_CPU =  8000000  </span>
<span class="comment">#         F_CPU = 11059200  </span>
<span class="comment">#         F_CPU = 14745600  </span>
<span class="comment">#         F_CPU = 16000000  </span>
<span class="comment">#         F_CPU = 18432000  </span>
<span class="comment">#         F_CPU = 20000000  </span>
<span class="constant">F_CPU</span> = <span class="number">8000000</span>  
  
  
<span class="comment"># Output format. (can be srec, ihex, binary)  </span>
<span class="constant">FORMAT</span> = ihex  
  
  
<span class="comment"># Target file name (without extension).  </span>
<span class="constant">TARGET</span> = main  
  
  
<span class="comment"># Object files directory  </span>
<span class="comment">#     To put object files in current directory, use a dot (.), do NOT make  </span>
<span class="comment">#     this an empty or blank macro!  </span>
<span class="constant">OBJDIR</span> = .  
  
  
<span class="comment"># List C source files here. (C dependencies are automatically generated.)  </span>
<span class="constant">SRC</span> = <span class="variable">$(</span><span class="constant">TARGET</span>).c   
  
<span class="comment"># List C++ source files here. (C dependencies are automatically generated.)  </span>
<span class="constant">CPPSRC</span> =   
  
  
<span class="comment"># List Assembler source files here.  </span>
<span class="comment">#     Make them always end in a capital .S.  Files ending in a lowercase .s  </span>
<span class="comment">#     will not be considered source files but generated files (assembler  </span>
<span class="comment">#     output from the compiler), and will be deleted upon "make clean"!  </span>
<span class="comment">#     Even though the DOS/Win* filesystem matches both .s and .S the same,  </span>
<span class="comment">#     it will preserve the spelling of the filenames, and gcc itself does  </span>
<span class="comment">#     care about how the name is spelled on its command-line.  </span>
<span class="constant">ASRC</span> =  
  
  
<span class="comment"># Optimization level, can be [0, 1, 2, 3, s].   </span>
<span class="comment">#     0 = turn off optimization. s = optimize for size.  </span>
<span class="comment">#     (Note: 3 is not always the best optimization level. See avr-libc FAQ.)  </span>
<span class="constant">OPT</span> = s  
  
  
<span class="comment"># Debugging format.  </span>
<span class="comment">#     Native formats for AVR-GCC's -g are dwarf-2 [default] or stabs.  </span>
<span class="comment">#     AVR Studio 4.10 requires dwarf-2.  </span>
<span class="comment">#     AVR [Extended] COFF format requires stabs, plus an avr-objcopy run.  </span>
<span class="constant">DEBUG</span> = dwarf-<span class="number">2</span>  
  
  
<span class="comment"># List any extra directories to look for include files here.  </span>
<span class="comment">#     Each directory must be seperated by a space.  </span>
<span class="comment">#     Use forward slashes for directory separators.  </span>
<span class="comment">#     For a directory that has spaces, enclose it in quotes.  </span>
<span class="constant">EXTRAINCDIRS</span> =   
  
  
<span class="comment"># Compiler flag to set the C Standard level.  </span>
<span class="comment">#     c89   = "ANSI" C  </span>
<span class="comment">#     gnu89 = c89 plus GCC extensions  </span>
<span class="comment">#     c99   = ISO C99 standard (not yet fully implemented)  </span>
<span class="comment">#     gnu99 = c99 plus GCC extensions  </span>
<span class="constant">CSTANDARD</span> = -std=gnu99  
  
  
<span class="comment"># Place -D or -U options here for C sources  </span>
<span class="constant">CDEFS</span> = -<span class="constant">DF_CPU</span>=<span class="variable">$(</span><span class="constant">F_CPU</span>)<span class="constant">UL</span>  
  
  
<span class="comment"># Place -D or -U options here for ASM sources  </span>
<span class="constant">ADEFS</span> = -<span class="constant">DF_CPU</span>=<span class="variable">$(</span><span class="constant">F_CPU</span>)  
  
  
<span class="comment"># Place -D or -U options here for C++ sources  </span>
<span class="constant">CPPDEFS</span> = -<span class="constant">DF_CPU</span>=<span class="variable">$(</span><span class="constant">F_CPU</span>)<span class="constant">UL</span>  
<span class="comment">#CPPDEFS += -D__STDC_LIMIT_MACROS  </span>
<span class="comment">#CPPDEFS += -D__STDC_CONSTANT_MACROS  </span>
  
  
  
<span class="comment">#---------------- Compiler Options C ----------------  </span>
<span class="comment">#  -g*:          generate debugging information  </span>
<span class="comment">#  -O*:          optimization level  </span>
<span class="comment">#  -f...:        tuning, see GCC manual and avr-libc documentation  </span>
<span class="comment">#  -Wall...:     warning level  </span>
<span class="comment">#  -Wa,...:      tell GCC to pass this to the assembler.  </span>
<span class="comment">#    -adhlns...: create assembler listing  </span>
<span class="constant">CFLAGS</span> = -g<span class="variable">$(</span><span class="constant">DEBUG</span>)  
<span class="constant">CFLAGS</span> += <span class="variable">$(</span><span class="constant">CDEFS</span>)  
<span class="constant">CFLAGS</span> += -<span class="constant">O</span><span class="variable">$(</span><span class="constant">OPT</span>)  
<span class="constant">CFLAGS</span> += -funsigned-char  
<span class="constant">CFLAGS</span> += -funsigned-bitfields  
<span class="constant">CFLAGS</span> += -fpack-struct  
<span class="constant">CFLAGS</span> += -fshort-enums  
<span class="constant">CFLAGS</span> += -<span class="constant">Wall</span>  
<span class="constant">CFLAGS</span> += -<span class="constant">Wstrict</span>-prototypes  
<span class="comment">#CFLAGS += -mshort-calls  </span>
<span class="comment">#CFLAGS += -fno-unit-at-a-time  </span>
<span class="comment">#CFLAGS += -Wundef  </span>
<span class="comment">#CFLAGS += -Wunreachable-code  </span>
<span class="comment">#CFLAGS += -Wsign-compare  </span>
<span class="constant">CFLAGS</span> += -<span class="constant">Wa</span>,-adhlns=<span class="variable">$(</span>&lt;<span class="symbol">:%</span>.c=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.lst)  
<span class="constant">CFLAGS</span> += <span class="variable">$(</span>patsubst %,-<span class="constant">I</span>%,<span class="variable">$(</span><span class="constant">EXTRAINCDIRS</span>))  
<span class="constant">CFLAGS</span> += <span class="variable">$(</span><span class="constant">CSTANDARD</span>)  
  
  
<span class="comment">#---------------- Compiler Options C++ ----------------  </span>
<span class="comment">#  -g*:          generate debugging information  </span>
<span class="comment">#  -O*:          optimization level  </span>
<span class="comment">#  -f...:        tuning, see GCC manual and avr-libc documentation  </span>
<span class="comment">#  -Wall...:     warning level  </span>
<span class="comment">#  -Wa,...:      tell GCC to pass this to the assembler.  </span>
<span class="comment">#    -adhlns...: create assembler listing  </span>
<span class="constant">CPPFLAGS</span> = -g<span class="variable">$(</span><span class="constant">DEBUG</span>)  
<span class="constant">CPPFLAGS</span> += <span class="variable">$(</span><span class="constant">CPPDEFS</span>)  
<span class="constant">CPPFLAGS</span> += -<span class="constant">O</span><span class="variable">$(</span><span class="constant">OPT</span>)  
<span class="constant">CPPFLAGS</span> += -funsigned-char  
<span class="constant">CPPFLAGS</span> += -funsigned-bitfields  
<span class="constant">CPPFLAGS</span> += -fpack-struct  
<span class="constant">CPPFLAGS</span> += -fshort-enums  
<span class="constant">CPPFLAGS</span> += -fno-exceptions  
<span class="constant">CPPFLAGS</span> += -<span class="constant">Wall</span>  
<span class="constant">CPPFLAGS</span> += -<span class="constant">Wundef</span>  
<span class="comment">#CPPFLAGS += -mshort-calls  </span>
<span class="comment">#CPPFLAGS += -fno-unit-at-a-time  </span>
<span class="comment">#CPPFLAGS += -Wstrict-prototypes  </span>
<span class="comment">#CPPFLAGS += -Wunreachable-code  </span>
<span class="comment">#CPPFLAGS += -Wsign-compare  </span>
<span class="constant">CPPFLAGS</span> += -<span class="constant">Wa</span>,-adhlns=<span class="variable">$(</span>&lt;<span class="symbol">:%</span>.cpp=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.lst)  
<span class="constant">CPPFLAGS</span> += <span class="variable">$(</span>patsubst %,-<span class="constant">I</span>%,<span class="variable">$(</span><span class="constant">EXTRAINCDIRS</span>))  
<span class="comment">#CPPFLAGS += $(CSTANDARD)  </span>
  
  
<span class="comment">#---------------- Assembler Options ----------------  </span>
<span class="comment">#  -Wa,...:   tell GCC to pass this to the assembler.  </span>
<span class="comment">#  -adhlns:   create listing  </span>
<span class="comment">#  -gstabs:   have the assembler create line number information; note that  </span>
<span class="comment">#             for use in COFF files, additional information about filenames  </span>
<span class="comment">#             and function names needs to be present in the assembler source  </span>
<span class="comment">#             files -- see avr-libc docs [FIXME: not yet described there]  </span>
<span class="comment">#  -listing-cont-lines: Sets the maximum number of continuation lines of hex   </span>
<span class="comment">#       dump that will be displayed for a given single line of source input.  </span>
<span class="constant">ASFLAGS</span> = <span class="variable">$(</span><span class="constant">ADEFS</span>) -<span class="constant">Wa</span>,-adhlns=<span class="variable">$(</span>&lt;<span class="symbol">:%</span>.<span class="constant">S</span>=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.lst),-gstabs,--listing-cont-lines=<span class="number">100</span>  
  
  
<span class="comment">#---------------- Library Options ----------------  </span>
<span class="comment"># Minimalistic printf version  </span>
<span class="constant">PRINTF_LIB_MIN</span> = -<span class="constant">Wl</span>,-u,vfprintf -lprintf_min  
  
<span class="comment"># Floating point printf version (requires MATH_LIB = -lm below)  </span>
<span class="constant">PRINTF_LIB_FLOAT</span> = -<span class="constant">Wl</span>,-u,vfprintf -lprintf_flt  
  
<span class="comment"># If this is left blank, then it will use the Standard printf version.  </span>
<span class="constant">PRINTF_LIB</span> =   
<span class="comment">#PRINTF_LIB = $(PRINTF_LIB_MIN)  </span>
<span class="comment">#PRINTF_LIB = $(PRINTF_LIB_FLOAT)  </span>
  
  
<span class="comment"># Minimalistic scanf version  </span>
<span class="constant">SCANF_LIB_MIN</span> = -<span class="constant">Wl</span>,-u,vfscanf -lscanf_min  
  
<span class="comment"># Floating point + %[ scanf version (requires MATH_LIB = -lm below)  </span>
<span class="constant">SCANF_LIB_FLOAT</span> = -<span class="constant">Wl</span>,-u,vfscanf -lscanf_flt  
  
<span class="comment"># If this is left blank, then it will use the Standard scanf version.  </span>
<span class="constant">SCANF_LIB</span> =   
<span class="comment">#SCANF_LIB = $(SCANF_LIB_MIN)  </span>
<span class="comment">#SCANF_LIB = $(SCANF_LIB_FLOAT)  </span>
  
  
<span class="constant">MATH_LIB</span> = -lm  
  
  
<span class="comment"># List any extra directories to look for libraries here.  </span>
<span class="comment">#     Each directory must be seperated by a space.  </span>
<span class="comment">#     Use forward slashes for directory separators.  </span>
<span class="comment">#     For a directory that has spaces, enclose it in quotes.  </span>
<span class="constant">EXTRALIBDIRS</span> =   
  
  
  
<span class="comment">#---------------- External Memory Options ----------------  </span>
  
<span class="comment"># 64 KB of external RAM, starting after internal RAM (ATmega128!),  </span>
<span class="comment"># used for variables (.data/.bss) and heap (malloc()).  </span>
<span class="comment">#EXTMEMOPTS = -Wl,-Tdata=0x801100,--defsym=__heap_end=0x80ffff  </span>
  
<span class="comment"># 64 KB of external RAM, starting after internal RAM (ATmega128!),  </span>
<span class="comment"># only used for heap (malloc()).  </span>
<span class="comment">#EXTMEMOPTS = -Wl,--section-start,.data=0x801100,--defsym=__heap_end=0x80ffff  </span>
  
<span class="constant">EXTMEMOPTS</span> =  
  
  
  
  
<span class="comment">#---------------- Linker Options ----------------  </span>
<span class="comment">#  -Wl,...:     tell GCC to pass this to linker.  </span>
<span class="comment">#    -Map:      create map file  </span>
<span class="comment">#    --cref:    add cross reference to  map file  </span>
<span class="constant">LDFLAGS</span> = -<span class="constant">Wl</span>,-<span class="constant">Map</span>=<span class="variable">$(</span><span class="constant">TARGET</span>).map,--cref  
<span class="constant">LDFLAGS</span> += <span class="variable">$(</span><span class="constant">EXTMEMOPTS</span>)  
<span class="constant">LDFLAGS</span> += <span class="variable">$(</span>patsubst %,-<span class="constant">L</span>%,<span class="variable">$(</span><span class="constant">EXTRALIBDIRS</span>))  
<span class="constant">LDFLAGS</span> += <span class="variable">$(</span><span class="constant">PRINTF_LIB</span>) <span class="variable">$(</span><span class="constant">SCANF_LIB</span>) <span class="variable">$(</span><span class="constant">MATH_LIB</span>)  
<span class="comment">#LDFLAGS += -T linker_script.x  </span>
  
  
  
<span class="comment">#---------------- Programming Options (avrdude) ----------------  </span>
  
<span class="comment"># Programming hardware  </span>
<span class="comment"># Type: avrdude -c ?  </span>
<span class="comment"># to get a full listing.  </span>
<span class="comment">#  </span>
<span class="constant">AVRDUDE_PROGRAMMER</span> = usbasp  
<span class="comment">#dragon_jtag  </span>
  
<span class="comment"># com1 = serial port. Use lpt1 to connect to parallel port.  </span>
<span class="constant">AVRDUDE_PORT</span> = usb   <span class="comment"># programmer connected to serial device  </span>
  
<span class="constant">AVRDUDE_WRITE_FLASH</span> = -<span class="constant">U</span> <span class="symbol">flash:</span><span class="symbol">w:</span><span class="variable">$(</span><span class="constant">TARGET</span>).hex  
<span class="comment">#AVRDUDE_WRITE_EEPROM = -U eeprom:w:$(TARGET).eep  </span>
  
  
<span class="comment"># Uncomment the following if you want avrdude's erase cycle counter.  </span>
<span class="comment"># Note that this counter needs to be initialized first using -Yn,  </span>
<span class="comment"># see avrdude manual.  </span>
<span class="comment">#AVRDUDE_ERASE_COUNTER = -y  </span>
  
<span class="comment"># Uncomment the following if you do /not/ wish a verification to be  </span>
<span class="comment"># performed after programming the device.  </span>
<span class="comment">#AVRDUDE_NO_VERIFY = -V  </span>
  
<span class="comment"># Increase verbosity level.  Please use this when submitting bug  </span>
<span class="comment"># reports about avrdude. See &lt;http://savannah.nongnu.org/projects/avrdude&gt;   </span>
<span class="comment"># to submit bug reports.  </span>
<span class="comment">#AVRDUDE_VERBOSE = -v -v  </span>
  
<span class="constant">AVRDUDE_FLAGS</span> = -p <span class="variable">$(</span><span class="constant">MCU</span>) -<span class="constant">P</span> <span class="variable">$(</span><span class="constant">AVRDUDE_PORT</span>) -c <span class="variable">$(</span><span class="constant">AVRDUDE_PROGRAMMER</span>)  
<span class="comment">#AVRDUDE_FLAGS = -p m16 -P $(AVRDUDE_PORT) -c $(AVRDUDE_PROGRAMMER)  </span>
<span class="constant">AVRDUDE_FLAGS</span> += <span class="variable">$(</span><span class="constant">AVRDUDE_NO_VERIFY</span>)  
<span class="constant">AVRDUDE_FLAGS</span> += <span class="variable">$(</span><span class="constant">AVRDUDE_VERBOSE</span>)  
<span class="constant">AVRDUDE_FLAGS</span> += <span class="variable">$(</span><span class="constant">AVRDUDE_ERASE_COUNTER</span>)  
  
  
  
<span class="comment">#---------------- Debugging Options ----------------  </span>
  
<span class="comment"># For simulavr only - target MCU frequency.  </span>
<span class="constant">DEBUG_MFREQ</span> = <span class="variable">$(</span><span class="constant">F_CPU</span>)  
  
<span class="comment"># Set the DEBUG_UI to either gdb or insight.  </span>
<span class="comment"># DEBUG_UI = gdb  </span>
<span class="constant">DEBUG_UI</span> = gdb  
  
<span class="comment"># Set the debugging back-end to either avarice, simulavr.  </span>
<span class="constant">DEBUG_BACKEND</span> = avarice  
<span class="comment">#DEBUG_BACKEND = simulavr  </span>
  
<span class="comment"># GDB Init Filename.  </span>
<span class="constant">GDBINIT_FILE</span> = __avr_gdbinit  
  
<span class="comment"># When using avarice settings for the JTAG  </span>
<span class="constant">JTAG_DEV</span> = usb  
  
<span class="comment"># Debugging port used to communicate between GDB / avarice / simulavr.  </span>
<span class="constant">DEBUG_PORT</span> = <span class="number">4242</span>  
  
<span class="comment"># Debugging host used to communicate between GDB / avarice / simulavr, normally  </span>
<span class="comment">#     just set to localhost unless doing some sort of crazy debugging when   </span>
<span class="comment">#     avarice is running on a different computer.  </span>
<span class="constant">DEBUG_HOST</span> = localhost  
  
  
  
<span class="comment">#============================================================================  </span>
  
  
<span class="comment"># Define programs and commands.  </span>
<span class="constant">SHELL</span> = sh  
<span class="constant">CC</span> = avr-gcc  
<span class="constant">OBJCOPY</span> = avr-objcopy  
<span class="constant">OBJDUMP</span> = avr-objdump  
<span class="constant">SIZE</span> = avr-size  
<span class="constant">AR</span> = avr-ar rcs  
<span class="constant">NM</span> = avr-nm  
<span class="constant">AVRDUDE</span> = avrdude  
<span class="constant">REMOVE</span> = rm -f  
<span class="constant">REMOVEDIR</span> = rm -rf  
<span class="constant">COPY</span> = cp  
<span class="constant">WINSHELL</span> =   
  
<span class="comment"># Define Messages  </span>
<span class="comment"># English  </span>
<span class="constant">MSG_ERRORS_NONE</span> = <span class="constant">Errors</span><span class="symbol">:</span> none  
<span class="constant">MSG_BEGIN</span> = -------- <span class="keyword">begin</span> --------  
<span class="constant">MSG_END</span> = --------  <span class="keyword">end</span>  --------  
<span class="constant">MSG_SIZE_BEFORE</span> = <span class="constant">Size</span> <span class="symbol">before:</span>   
<span class="constant">MSG_SIZE_AFTER</span> = <span class="constant">Size</span> <span class="symbol">after:</span>  
<span class="constant">MSG_COFF</span> = <span class="constant">Converting</span> to <span class="constant">AVR</span> <span class="constant">COFF</span><span class="symbol">:</span>  
<span class="constant">MSG_EXTENDED_COFF</span> = <span class="constant">Converting</span> to <span class="constant">AVR</span> <span class="constant">Extended</span> <span class="constant">COFF</span><span class="symbol">:</span>  
<span class="constant">MSG_FLASH</span> = <span class="constant">Creating</span> load file <span class="keyword">for</span> <span class="constant">Flash</span><span class="symbol">:</span>  
<span class="constant">MSG_EEPROM</span> = <span class="constant">Creating</span> load file <span class="keyword">for</span> <span class="constant">EEPROM</span><span class="symbol">:</span>  
<span class="constant">MSG_EXTENDED_LISTING</span> = <span class="constant">Creating</span> <span class="constant">Extended</span> <span class="constant">Listing</span><span class="symbol">:</span>  
<span class="constant">MSG_SYMBOL_TABLE</span> = <span class="constant">Creating</span> <span class="constant">Symbol</span> <span class="constant">Table</span><span class="symbol">:</span>  
<span class="constant">MSG_LINKING</span> = <span class="constant">Linking</span><span class="symbol">:</span>  
<span class="constant">MSG_COMPILING</span> = <span class="constant">Compiling</span> <span class="constant">C</span><span class="symbol">:</span>  
<span class="constant">MSG_COMPILING_CPP</span> = <span class="constant">Compiling</span> <span class="constant">C</span>++<span class="symbol">:</span>  
<span class="constant">MSG_ASSEMBLING</span> = <span class="constant">Assembling</span><span class="symbol">:</span>  
<span class="constant">MSG_CLEANING</span> = <span class="constant">Cleaning</span> <span class="symbol">project:</span>  
<span class="constant">MSG_CREATING_LIBRARY</span> = <span class="constant">Creating</span> <span class="symbol">library:</span>  
  
  
  
  
<span class="comment"># Define all object files.  </span>
<span class="constant">OBJ</span> = <span class="variable">$(</span><span class="constant">SRC</span><span class="symbol">:%</span>.c=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.o) <span class="variable">$(</span><span class="constant">CPPSRC</span><span class="symbol">:%</span>.cpp=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.o) <span class="variable">$(</span><span class="constant">ASRC</span><span class="symbol">:%</span>.<span class="constant">S</span>=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.o)   
  
<span class="comment"># Define all listing files.  </span>
<span class="constant">LST</span> = <span class="variable">$(</span><span class="constant">SRC</span><span class="symbol">:%</span>.c=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.lst) <span class="variable">$(</span><span class="constant">CPPSRC</span><span class="symbol">:%</span>.cpp=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.lst) <span class="variable">$(</span><span class="constant">ASRC</span><span class="symbol">:%</span>.<span class="constant">S</span>=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.lst)   
  
  
<span class="comment"># Compiler flags to generate dependency files.  </span>
<span class="constant">GENDEPFLAGS</span> = -<span class="constant">MMD</span> -<span class="constant">MP</span> -<span class="constant">MF</span> .dep/<span class="variable">$(</span><span class="variable">@F</span>).d  
  
  
<span class="comment"># Combine all necessary flags and optional flags.  </span>
<span class="comment"># Add target processor to flags.  </span>
<span class="constant">ALL_CFLAGS</span> = -mmcu=<span class="variable">$(</span><span class="constant">MCU</span>) -<span class="constant">I</span>. <span class="variable">$(</span><span class="constant">CFLAGS</span>) <span class="variable">$(</span><span class="constant">GENDEPFLAGS</span>)  
<span class="constant">ALL_CPPFLAGS</span> = -mmcu=<span class="variable">$(</span><span class="constant">MCU</span>) -<span class="constant">I</span>. -x c++ <span class="variable">$(</span><span class="constant">CPPFLAGS</span>) <span class="variable">$(</span><span class="constant">GENDEPFLAGS</span>)  
<span class="constant">ALL_ASFLAGS</span> = -mmcu=<span class="variable">$(</span><span class="constant">MCU</span>) -<span class="constant">I</span>. -x assembler-with-cpp <span class="variable">$(</span><span class="constant">ASFLAGS</span>)  
  
  
  
  
  
<span class="comment"># Default target.  </span>
<span class="symbol">all:</span> <span class="keyword">begin</span> gccversion sizebefore build sizeafter <span class="keyword">end</span>  
  
<span class="comment"># Change the build target to build a HEX file or a library.  </span>
<span class="symbol">build:</span> elf hex eep lss sym  
<span class="comment">#build: lib  </span>
  
  
<span class="symbol">elf:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).elf  
<span class="symbol">hex:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).hex  
<span class="symbol">eep:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).eep  
<span class="symbol">lss:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).lss  
<span class="symbol">sym:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).sym  
<span class="constant">LIBNAME</span>=lib<span class="variable">$(</span><span class="constant">TARGET</span>).a  
<span class="symbol">lib:</span> <span class="variable">$(</span><span class="constant">LIBNAME</span>)  
  
  
  
<span class="comment"># Eye candy.  </span>
<span class="comment"># AVR Studio 3.x does not check make's exit code but relies on  </span>
<span class="comment"># the following magic strings to be generated by the compile job.  </span>
<span class="symbol">begin:</span>  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_BEGIN</span>)  
  
<span class="symbol">end:</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_END</span>)  
    <span class="variable">@echo</span>  
  
  
<span class="comment"># Display size of file.  </span>
<span class="constant">HEXSIZE</span> = <span class="variable">$(</span><span class="constant">SIZE</span>) --target=<span class="variable">$(</span><span class="constant">FORMAT</span>) <span class="variable">$(</span><span class="constant">TARGET</span>).hex  
<span class="constant">ELFSIZE</span> = <span class="variable">$(</span><span class="constant">SIZE</span>) --mcu=<span class="variable">$(</span><span class="constant">MCU</span>) --format=avr <span class="variable">$(</span><span class="constant">TARGET</span>).elf  
  
<span class="symbol">sizebefore:</span>  
    <span class="variable">@if</span> test -f <span class="variable">$(</span><span class="constant">TARGET</span>).elf; <span class="keyword">then</span> echo; echo <span class="variable">$(</span><span class="constant">MSG_SIZE_BEFORE</span>); <span class="variable">$(</span><span class="constant">ELFSIZE</span>); \  
    <span class="number">2</span>&gt;<span class="regexp">/dev/null</span>; echo; fi  
  
<span class="symbol">sizeafter:</span>  
    <span class="variable">@if</span> test -f <span class="variable">$(</span><span class="constant">TARGET</span>).elf; <span class="keyword">then</span> echo; echo <span class="variable">$(</span><span class="constant">MSG_SIZE_AFTER</span>); <span class="variable">$(</span><span class="constant">ELFSIZE</span>); \  
    <span class="number">2</span>&gt;<span class="regexp">/dev/null</span>; echo; fi  
  
  
  
<span class="comment"># Display compiler version information.  </span>
gccversion <span class="symbol">:</span>   
    @<span class="variable">$(</span><span class="constant">CC</span>) --version  
  
  
  
<span class="comment"># Program the device.    </span>
<span class="symbol">program:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).hex <span class="variable">$(</span><span class="constant">TARGET</span>).eep  
    <span class="variable">$(</span><span class="constant">AVRDUDE</span>) <span class="variable">$(</span><span class="constant">AVRDUDE_FLAGS</span>) <span class="variable">$(</span><span class="constant">AVRDUDE_WRITE_FLASH</span>) <span class="variable">$(</span><span class="constant">AVRDUDE_WRITE_EEPROM</span>)  
  
  
<span class="comment"># Generate avr-gdb config/init file which does the following:  </span>
<span class="comment">#     define the reset signal, load the target file, connect to target, and set   </span>
<span class="comment">#     a breakpoint at main().  </span>
gdb-<span class="symbol">config:</span>   
    @<span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">GDBINIT_FILE</span>)  
    <span class="variable">@echo</span> define reset &gt;&gt; <span class="variable">$(</span><span class="constant">GDBINIT_FILE</span>)  
    <span class="variable">@echo</span> <span class="constant">SIGNAL</span> <span class="constant">SIGHUP</span> &gt;&gt; <span class="variable">$(</span><span class="constant">GDBINIT_FILE</span>)  
    <span class="variable">@echo</span> <span class="keyword">end</span> &gt;&gt; <span class="variable">$(</span><span class="constant">GDBINIT_FILE</span>)  
    <span class="variable">@echo</span> file <span class="variable">$(</span><span class="constant">TARGET</span>).elf &gt;&gt; <span class="variable">$(</span><span class="constant">GDBINIT_FILE</span>)  
    <span class="variable">@echo</span> target remote <span class="variable">$(</span><span class="constant">DEBUG_HOST</span>)<span class="symbol">:</span><span class="variable">$(</span><span class="constant">DEBUG_PORT</span>)  &gt;&gt; <span class="variable">$(</span><span class="constant">GDBINIT_FILE</span>)  
ifeq (<span class="variable">$(</span><span class="constant">DEBUG_BACKEND</span>),simulavr)  
    <span class="variable">@echo</span> load  &gt;&gt; <span class="variable">$(</span><span class="constant">GDBINIT_FILE</span>)  
endif  
    <span class="variable">@echo</span> <span class="keyword">break</span> main &gt;&gt; <span class="variable">$(</span><span class="constant">GDBINIT_FILE</span>)  
  
<span class="symbol">debug:</span> gdb-config <span class="variable">$(</span><span class="constant">TARGET</span>).elf  
ifeq (<span class="variable">$(</span><span class="constant">DEBUG_BACKEND</span>), avarice)  
    <span class="variable">@echo</span> <span class="constant">Starting</span> <span class="constant">AVaRICE</span> - <span class="constant">Press</span> enter <span class="keyword">when</span> <span class="string">"waiting to connect"</span> message displays.  
    <span class="comment">#@$(WINSHELL) /c start avarice --jtag $(JTAG_DEV) --erase --program --file \  </span>
    <span class="comment">#$(TARGET).hex $(DEBUG_HOST):$(DEBUG_PORT)  </span>
    <span class="comment">#@$(WINSHELL) /c pause  </span>
    @<span class="variable">$(</span><span class="constant">WINSHELL</span>)  avarice --xmega -g --jtag <span class="variable">$(</span><span class="constant">JTAG_DEV</span>) --erase --program --file   \  
    <span class="variable">$(</span><span class="constant">TARGET</span>).<span class="symbol">elf:</span><span class="variable">$(</span><span class="constant">DEBUG_PORT</span>)  
    <span class="comment">#@$(WINSHELL)  pause  </span>
  
<span class="keyword">else</span>  
    @<span class="variable">$(</span><span class="constant">WINSHELL</span>) /c start simulavr --gdbserver --device <span class="variable">$(</span><span class="constant">MCU</span>) --clock-freq \  
    <span class="variable">$(</span><span class="constant">DEBUG_MFREQ</span>) --port <span class="variable">$(</span><span class="constant">DEBUG_PORT</span>)  
endif  
    <span class="comment">#@$(WINSHELL) /c start avr-$(DEBUG_UI) --command=$(GDBINIT_FILE)  </span>
    @<span class="variable">$(</span><span class="constant">WINSHELL</span>)  <span class="variable">$(</span><span class="constant">DEBUG_UI</span>)  
  
  
  
  
<span class="comment"># Convert ELF to COFF for use in debugging / simulating in AVR Studio or VMLAB.  </span>
<span class="constant">COFFCONVERT</span> = <span class="variable">$(</span><span class="constant">OBJCOPY</span>) --debugging  
<span class="constant">COFFCONVERT</span> += --change-section-address .data-<span class="number">0x800000</span>  
<span class="constant">COFFCONVERT</span> += --change-section-address .bss-<span class="number">0x800000</span>  
<span class="constant">COFFCONVERT</span> += --change-section-address .noinit-<span class="number">0x800000</span>  
<span class="constant">COFFCONVERT</span> += --change-section-address .eeprom-<span class="number">0x810000</span>  
  
  
  
<span class="symbol">coff:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).elf  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_COFF</span>) <span class="variable">$(</span><span class="constant">TARGET</span>).cof  
    <span class="variable">$(</span><span class="constant">COFFCONVERT</span>) -<span class="constant">O</span> coff-avr <span class="variable">$&lt;</span> <span class="variable">$(</span><span class="constant">TARGET</span>).cof  
  
  
<span class="symbol">extcoff:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).elf  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_EXTENDED_COFF</span>) <span class="variable">$(</span><span class="constant">TARGET</span>).cof  
    <span class="variable">$(</span><span class="constant">COFFCONVERT</span>) -<span class="constant">O</span> coff-ext-avr <span class="variable">$&lt;</span> <span class="variable">$(</span><span class="constant">TARGET</span>).cof  
  
  
  
<span class="comment"># Create final output files (.hex, .eep) from ELF output file.  </span>
%.<span class="symbol">hex:</span> %.elf  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_FLASH</span>) <span class="variable">$@</span>  
    <span class="variable">$(</span><span class="constant">OBJCOPY</span>) -<span class="constant">O</span> <span class="variable">$(</span><span class="constant">FORMAT</span>) -<span class="constant">R</span> .eeprom -<span class="constant">R</span> .fuse -<span class="constant">R</span> .lock <span class="variable">$&lt;</span> <span class="variable">$@</span>  
  
%.<span class="symbol">eep:</span> %.elf  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_EEPROM</span>) <span class="variable">$@</span>  
    -<span class="variable">$(</span><span class="constant">OBJCOPY</span>) -j .eeprom --set-section-flags=.eeprom=<span class="string">"alloc,load"</span> \  
    --change-section-lma .eeprom=<span class="number">0</span> --no-change-warnings -<span class="constant">O</span> <span class="variable">$(</span><span class="constant">FORMAT</span>) <span class="variable">$&lt;</span> <span class="variable">$@</span> || exit <span class="number">0</span>  
  
<span class="comment"># Create extended listing file from ELF output file.  </span>
%.<span class="symbol">lss:</span> %.elf  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_EXTENDED_LISTING</span>) <span class="variable">$@</span>  
    <span class="variable">$(</span><span class="constant">OBJDUMP</span>) -h -<span class="constant">S</span> -z <span class="variable">$&lt;</span> &gt; <span class="variable">$@</span>  
  
<span class="comment"># Create a symbol table from ELF output file.  </span>
%.<span class="symbol">sym:</span> %.elf  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_SYMBOL_TABLE</span>) <span class="variable">$@</span>  
    <span class="variable">$(</span><span class="constant">NM</span>) -n <span class="variable">$&lt;</span> &gt; <span class="variable">$@</span>  
  
  
  
<span class="comment"># Create library from object files.  </span>
.<span class="constant">SECONDARY</span> <span class="symbol">:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).a  
.<span class="constant">PRECIOUS</span> <span class="symbol">:</span> <span class="variable">$(</span><span class="constant">OBJ</span>)  
%.<span class="symbol">a:</span> <span class="variable">$(</span><span class="constant">OBJ</span>)  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_CREATING_LIBRARY</span>) <span class="variable">$@</span>  
    <span class="variable">$(</span><span class="constant">AR</span>) <span class="variable">$@</span> <span class="variable">$(</span><span class="constant">OBJ</span>)  
  
  
<span class="comment"># Link: create ELF output file from object files.  </span>
.<span class="constant">SECONDARY</span> <span class="symbol">:</span> <span class="variable">$(</span><span class="constant">TARGET</span>).elf  
.<span class="constant">PRECIOUS</span> <span class="symbol">:</span> <span class="variable">$(</span><span class="constant">OBJ</span>)  
%.<span class="symbol">elf:</span> <span class="variable">$(</span><span class="constant">OBJ</span>)  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_LINKING</span>) <span class="variable">$@</span>  
    <span class="variable">$(</span><span class="constant">CC</span>) <span class="variable">$(</span><span class="constant">ALL_CFLAGS</span>) <span class="variable">$^</span> --output <span class="variable">$@</span> <span class="variable">$(</span><span class="constant">LDFLAGS</span>)  
  
  
<span class="comment"># Compile: create object files from C source files.  </span>
<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.o <span class="symbol">:</span> %.c  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_COMPILING</span>) <span class="variable">$&lt;</span>  
    <span class="variable">$(</span><span class="constant">CC</span>) -c <span class="variable">$(</span><span class="constant">ALL_CFLAGS</span>) <span class="variable">$&lt;</span> -o <span class="variable">$@</span>   
  
  
<span class="comment"># Compile: create object files from C++ source files.  </span>
<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.o <span class="symbol">:</span> %.cpp  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_COMPILING_CPP</span>) <span class="variable">$&lt;</span>  
    <span class="variable">$(</span><span class="constant">CC</span>) -c <span class="variable">$(</span><span class="constant">ALL_CPPFLAGS</span>) <span class="variable">$&lt;</span> -o <span class="variable">$@</span>   
  
  
  
<span class="comment"># Compile: create assembler files from C source files.  </span>
%.s <span class="symbol">:</span> %.c  
    <span class="variable">$(</span><span class="constant">CC</span>) -<span class="constant">S</span> <span class="variable">$(</span><span class="constant">ALL_CFLAGS</span>) <span class="variable">$&lt;</span> -o <span class="variable">$@</span>  
  
  
<span class="comment"># Compile: create assembler files from C++ source files.  </span>
%.s <span class="symbol">:</span> %.cpp  
    <span class="variable">$(</span><span class="constant">CC</span>) -<span class="constant">S</span> <span class="variable">$(</span><span class="constant">ALL_CPPFLAGS</span>) <span class="variable">$&lt;</span> -o <span class="variable">$@</span>  
  
  
<span class="comment"># Assemble: create object files from assembler source files.  </span>
<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.o <span class="symbol">:</span> %.<span class="constant">S</span>  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_ASSEMBLING</span>) <span class="variable">$&lt;</span>  
    <span class="variable">$(</span><span class="constant">CC</span>) -c <span class="variable">$(</span><span class="constant">ALL_ASFLAGS</span>) <span class="variable">$&lt;</span> -o <span class="variable">$@</span>  
  
  
<span class="comment"># Create preprocessed source for use in sending a bug report.  </span>
%.i <span class="symbol">:</span> %.c  
    <span class="variable">$(</span><span class="constant">CC</span>) -<span class="constant">E</span> -mmcu=<span class="variable">$(</span><span class="constant">MCU</span>) -<span class="constant">I</span>. <span class="variable">$(</span><span class="constant">CFLAGS</span>) <span class="variable">$&lt;</span> -o <span class="variable">$@</span>   
  
  
<span class="comment"># Target: clean project.  </span>
<span class="symbol">clean:</span> <span class="keyword">begin</span> clean_list <span class="keyword">end</span>  
  
clean_list <span class="symbol">:</span>  
    <span class="variable">@echo</span>  
    <span class="variable">@echo</span> <span class="variable">$(</span><span class="constant">MSG_CLEANING</span>)  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">TARGET</span>).hex  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">TARGET</span>).eep  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">TARGET</span>).cof  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">TARGET</span>).elf  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">TARGET</span>).map  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">TARGET</span>).sym  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">TARGET</span>).lss  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">SRC</span><span class="symbol">:%</span>.c=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.o)  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">SRC</span><span class="symbol">:%</span>.c=<span class="variable">$(</span><span class="constant">OBJDIR</span>)/%.lst)  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">SRC</span><span class="symbol">:</span>.c=.s)  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">SRC</span><span class="symbol">:</span>.c=.d)  
    <span class="variable">$(</span><span class="constant">REMOVE</span>) <span class="variable">$(</span><span class="constant">SRC</span><span class="symbol">:</span>.c=.i)  
    <span class="variable">$(</span><span class="constant">REMOVEDIR</span>) .dep  
  
  
<span class="comment"># Create object files directory  </span>
<span class="variable">$(</span>shell mkdir <span class="variable">$(</span><span class="constant">OBJDIR</span>) <span class="number">2</span>&gt;<span class="regexp">/dev/null</span>)  
  
  
<span class="comment"># Include the dependency files.  </span>
-<span class="keyword">include</span> <span class="variable">$(</span>shell mkdir .dep <span class="number">2</span>&gt;<span class="regexp">/dev/null</span>) <span class="variable">$(</span>wildcard .dep/*)  
  
  
<span class="comment"># Listing of phony targets.  </span>
.<span class="constant">PHONY</span> <span class="symbol">:</span> all <span class="keyword">begin</span> finish <span class="keyword">end</span> sizebefore sizeafter gccversion \  
build elf hex eep lss sym coff extcoff \  
clean clean_list program debug gdb-config
</pre></td></tr></table></figure>


      
    </div>
    <footer>
      
        
  
  <div class="categories">
    <a href="/categories/avr系列/">avr系列</a>
  </div>

        
        <!-- 
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>
 -->
       <div class="bdsharebuttonbox"><a href="#" class="bds_more" data-cmd="more"></a><a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a><a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a><a href="#" class="bds_tqq" data-cmd="tqq" title="分享到腾讯微博"></a><a href="#" class="bds_renren" data-cmd="renren" title="分享到人人网"></a><a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a></div>
<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"1","bdSize":"32"},"share":{},"image":{"viewList":["qzone","tsina","tqq","renren","weixin"],"viewText":"分享到：","viewSize":"16"},"selectShare":{"bdContainerClass":null,"bdSelectMiniList":["qzone","tsina","tqq","renren","weixin"]}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script> 
      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
<!-- Duoshuo Comment BEGIN -->
	<div class="ds-thread"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"galaxy2416"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = 'http://static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
<!-- Duoshuo Comment END -->
</section>



</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="搜索">
    <input type="hidden" name="q" value="site:galaxy2416.github.io">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">分类</h3> 
  <ul class="entry">
  
    <li><a href="/categories/51单片机/">51单片机</a><small>1</small></li>
  
    <li><a href="/categories/avr系列/">avr系列</a><small>2</small></li>
  
    <li><a href="/categories/hexo/">hexo</a><small>1</small></li>
  
    <li><a href="/categories/math/">math</a><small>1</small></li>
  
    <li><a href="/categories/vim/">vim</a><small>2</small></li>
  
  </ul>
</div>
<div id="btn1">显示</div>



  
<div class="widget tag">
  <h3 class="title">标签</h3>
  <ul class="entry">
  
    <li><a href="/tags/第一篇文章/">第一篇文章</a><small>1</small></li>
  
  </ul>
</div>


  <div class="widget tag">
<h3 class="title">友情链接</h3>
<ul class="entry">
<li><a href="http://zipperary.com/" title="Zippera's Blog">Zippera</a></li>
<li><a href="http://Sherlockyu.github.io/" title="Zippera's Blog">Sherlockyu</a></li>
</ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
   I am Galaxy2416 ~ I am a lazzy man who is favourite of <br> comic , history , hardware and math. Be happy~~(*^__^*)……<br> 
  &copy; 2015 galaxy2416
  
</div>
<div class="clearfix"></div>
</footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>



<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

<div id="totop" style="position:fixed;bottom:150px;right:50px;cursor: pointer;">
<a title="返回顶部"><img src="/imgs/scrollup.png"/></a>
</div>

<script src="/js/totop.js"></script>

</body>
</html>
